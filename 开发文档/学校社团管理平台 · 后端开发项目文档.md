# 学校社团管理平台 · 后端开发项目文档

> 本文档用于指导后端从零开始开发“学校社团管理平台”，覆盖系统架构、模块划分、数据库设计、接口规范、权限模型、项目结构等核心内容。后续可在此文档中逐步加入 AI / Agent 能力。

---

# 1. 项目概述

学校社团管理平台包含两个端：

* **C 端（学生用户端）**：用于学生浏览社团、活动、报名、加入社团等
* **后台管理端（管理员/老师）**：用于管理社团、审核活动、发布公告等

后端需提供稳健的 REST API、权限机制、数据一致性保证，以及未来可扩展接入 LLM / Agent 能力。

---

# 2. 技术栈设计

推荐技术栈（基于用户选择：Java 21 + Spring Boot 3.4.4）：

* **语言**：Java 21（LTS，性能更好，虚拟线程支持）
* **框架**：Spring Boot 3.4.4（基于 Spring Framework 6，全面支持 Jakarta EE 10）
* **数据库**：MySQL
* **鉴权**：Sa-Token
* **ORM**：MyBatis Plus
* **文件上传与存储**：阿里云OSS
* **文档工具**：Swagger / Springdoc OpenAPI
* **构建工具**：Maven / Gradle
* **版本控制**：Git + GitHub

---

# 3. 系统功能模块

## 3.1 C 端（学生用户）

### 1. 用户模块

* 登录/注册（注册信息包括：username、password、phone、email）
* 用户信息查询与修改
* 查看加入的社团

### 2. 社团模块

* 浏览社团列表
* 查看社团详情
* 申请加入社团

### 3. 活动模块

* 浏览活动列表
* 查看活动详情
* 活动报名、取消报名
* 查看历史报名记录

### 4. 公告/通知

* 系统公告广播
* 个人通知消息

---

## 3.2 管理后台

### 1. 社团管理

* 新建社团
* 审核学生申请
* 增删改查社团信息

### 2. 活动管理

* 创建/审核活动
* 控制活动是否上架

### 3. 用户管理

* 查询用户列表
* 禁用用户（可选）

### 4. 公告管理

* 发布公告
* 管理公告内容

### 5. 数据统计

* 社团数量
* 活动数量
* 报名统计

---

# 4. 权限模型设计（RBAC）

角色说明：

| 角色                          | 能力                          |
| ----------------------------- | ----------------------------- |
| User（学生）                  | 浏览社团/活动、报名、加入社团 |
| ClubAdmin（社团负责人，可选） | 管理自己社团的活动与成员      |
| SystemAdmin（系统管理员）     | 后台管理所有数据              |

权限机制使用 **Sa-Token** 进行登录状态管理、权限校验与注解式拦截（如 `@SaCheckRole`、`@SaCheckPermission`）。

Sa-Token 的 Token 由框架自动生成并维护，不需要手动设计结构。通常包含：

* 用户唯一会话 ID（Token Value）
* 会话信息（在 Sa-Token 内部 Session 中存储）
* 用户角色（可放入 `StpUtil.getSession().set()`）
* 自定义权限数据（可选）

**对于接口要有权限要求，比如：**

| 用户模块接口         | 请求方式 | 描述                 | 权限要求               |
| -------------------- | -------- | -------------------- | ---------------------- |
| `/api/user/register` | POST     | 用户自助注册         | **公开接口，无需权限** |
| `/api/user/login`    | POST     | 用户登录，获取 Token | **公开接口，无需权限** |
| `/api/user/info`     | GET      | 获取当前登录用户信息 | `user`                 |
| `/api/user/update`   | POST     | 更新个人资料         | `user`                 |

---

# 5. 数据库设计（ER 结构）

统一约定：所有业务表均包含以下字段：

* `create_time` 创建时间
* `update_time` 修改时间
* `is_deleted` 逻辑删除（0 未删除 / 1 已删除）

---

## 5.1 User（用户表）

* id
* username（账号）
* password（密码，需加密）
* avatar（头像）
* gender（性别）
* phone（手机号）
* email（可选）
* role（user / club_admin / admin）
* status（0 正常；1 禁用）
* create_time
* update_time
* is_deleted

---

## 5.2 Club（社团表）

* id
* name（社团名称）
* description（简介）
* logo（社团图标）
* status（审核中 / 正常 / 禁用）
* create_user（创建者 user_id）
* create_time
* update_time
* is_deleted

---

## 5.3 ClubMember（社团成员表）

* id
* club_id
* user_id
* role（member / leader）
* status（待审核 / 已通过 / 已拒绝）
* join_time
* memo（备注，可选）
* create_time
* update_time
* is_deleted

---

## 5.4 Activity（活动表）

* id
* club_id
* title（标题）
* content（活动内容）
* cover（封面图）
* location（地点）
* start_time
* end_time
* status（草稿 / 审核中 / 已发布 / 下架）
* max_members（允许报名人数）
* create_time
* update_time
* is_deleted

---

## 5.5 ActivitySignup（活动报名表）

* id
* activity_id
* user_id
* status（已报名 / 已取消 / 已签到 等）
* signup_time
* remark（备注，可选）
* create_time
* update_time
* is_deleted

---

## 5.6 Announcement（公告）

* id
* title
* content
* type（系统公告/活动公告 等）
* create_user（管理员 ID）
* create_time
* update_time
* is_deleted

---

## 5.7 Message（通知表）

* id
* user_id
* content
* type（系统通知 / 审核消息 / 活动提醒）
* read_flag（0 未读 / 1 已读）
* create_time
* update_time
* is_deleted

---

# 6. API 设计（非 AI 阶段）

API 设计（非 AI 阶段）

此处列出核心接口分类，详细接口可继续补充。

## 6.1 用户模块

```
POST /api/user/login
POST /api/user/register
GET  /api/user/info
PUT  /api/user/update
```

## 6.2 社团模块

```
GET  /api/club/list
GET  /api/club/{id}
POST /api/club/applyJoin
GET  /api/club/my
```

## 6.3 活动模块

```
GET  /api/activity/list
GET  /api/activity/{id}
POST /api/activity/signup
GET  /api/activity/my
```

## 6.4 公告模块

```
GET /api/announcement/list
GET /api/announcement/{id}
```

## 6.5 管理端接口

### 社团管理

```
POST /api/admin/club/create
POST /api/admin/club/approve
PUT  /api/admin/club/update
```

### 活动管理

```
POST /api/admin/activity/create
POST /api/admin/activity/approve
PUT  /api/admin/activity/update
```

### 用户管理

```
GET  /api/admin/user/list
PUT  /api/admin/user/disable
```

### 公告管理

```
POST /api/admin/announcement/create
PUT  /api/admin/announcement/update
DELETE /api/admin/announcement/delete
```

---

# 7. 项目结构（建议）

以 Spring Boot 为例：

```
project/
  ├─ common/（异常、工具类）
  ├─ config/（全局配置）
  ├─ controller/（API 控制器）
  ├─ service/（业务逻辑）
  ├─ mapper/（数据库访问）
  ├─ model/（实体类）
  ├─ dto/（请求 & 响应对象）
  ├─ security/（Sa-Token 权限控制与登录配置）
  ├─ utils/
  └─ resources/
```

---

# 8. 开发流程（非 AI 阶段）

1. 搭建基础项目框架（Spring Boot / Django / FastAPI）
2. 实现基于 **Sa-Token** 的登录与权限控制
3. 搭建数据库表结构
4. 编写核心业务模块（社团、活动、报名）
5. 实现后台管理模块
6. 接入 Redis 用于缓存优化
7. 添加 Swagger 文档
8. 部署运行

---

# 9. AI / Agent 功能预留点（未来加入）

为方便未来扩展准备：

### 1. 专门的 AI 控制器

```
/api/ai/chat
/api/ai/recommend
```

### 2. Agent 任务调度（可选）

如自动生成社团活动文案、审核内容等。

---

# 10. 接口错误码规范

为了保证前后端通信的一致性与可维护性，系统统一采用标准化响应结构以及统一错误码设计。如下为统一的错误码规范。

---

## 10.1 响应结构统一规范

所有接口返回结构遵循以下格式：

```json
{
  "code": 0,
  "msg": "success",
  "data": {}
}
```

字段说明：

* **code**：错误码，0 表示成功，非 0 表示失败。
* **msg**：错误信息（给前端或用户查看）。
* **data**：接口返回的数据内容。

---

## 10.2 错误码分类（推荐）

错误码采用 **五段式设计**，格式如下：

```
A B C D E
```

含义：

| 段位 | 含义                                       | 举例  |
| ---- | ------------------------------------------ | ----- |
| A    | 错误级别（0 成功、1 业务异常、2 系统异常） | 1xxxx |
| B    | 业务域（用户 01、社团 02、活动 03 等）     | x01xx |
| C    | 模块自定义编号                             | xx1xx |
| D/E  | 具体错误编号                               | xxx01 |

### ✔ 成功码

| code | msg     |
| ---- | ------- |
| 0    | success |

---

## 10.3 通用错误码

| code  | msg          | 说明                                          |
| ----- | ------------ | --------------------------------------------- |
| 10001 | 参数校验失败 | 参数缺失、非法参数等                          |
| 10002 | 未登录       | Token 无效或过期（Sa-Token 自动处理，可覆盖） |
| 10003 | 无权限       | 角色或权限不足                                |
| 10004 | 数据不存在   | 查询了不存在的数据                            |
| 10005 | 操作失败     | 无具体原因的业务失败                          |
| 20001 | 系统异常     | 未知错误（需记录日志）                        |

---

## 10.4 用户模块（01）错误码

| code  | msg          | 场景           |
| ----- | ------------ | -------------- |
| 10101 | 用户不存在   | 登录账户不匹配 |
| 10102 | 密码错误     | 登录密码错误   |
| 10103 | 用户已被禁用 | status = 1     |
| 10104 | 手机号已注册 | 注册冲突       |

---

## 10.5 社团模块（02）错误码

| code  | msg          | 场景               |
| ----- | ------------ | ------------------ |
| 10201 | 社团不存在   | 查询、加入时不存在 |
| 10202 | 社团已禁用   | status != 正常     |
| 10203 | 已申请加入   | 不能重复申请       |
| 10204 | 不是社团成员 | 无法操作活动等场景 |

---

## 10.6 活动模块（03）错误码

| code  | msg          | 场景               |
| ----- | ------------ | ------------------ |
| 10301 | 活动不存在   | 查询详情失败       |
| 10302 | 活动未发布   | 草稿、审核中或下架 |
| 10303 | 报名人数已满 | max_members 达上限 |
| 10304 | 已报名该活动 | 防止重复报名       |
| 10305 | 活动已结束   | end_time < now     |

---

## 10.7 公告模块（04）错误码

| code  | msg            |
| ----- | -------------- |
| 10401 | 公告不存在     |
| 10402 | 无权限管理公告 |

---

## 10.8 通知模块（05）错误码

| code  | msg        |
| ----- | ---------- |
| 10501 | 消息不存在 |

---

## 10.9 错误码规范总结

* 所有错误码必须唯一，不重复。
* 业务异常必须准确对应错误码类别。
* 系统异常统一为 **20001**，并记录日志。
* 统一响应结构保证前端处理逻辑简单统一。
* Sa-Token 的未登录与无权限异常可映射到 10002、10003。


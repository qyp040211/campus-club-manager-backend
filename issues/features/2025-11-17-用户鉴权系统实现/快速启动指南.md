# 快速启动指南

## 前置准备

### 1. 环境要求

- JDK 21+
- Maven 3.8+
- MySQL 8.0+
- IDE（推荐 IntelliJ IDEA）

### 2. 数据库准备

```bash
# 登录 MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE campus_club CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 使用数据库
USE campus_club;

# 执行初始化脚本
SOURCE /path/to/src/main/resources/db/migration/V1__Create_User_Table.sql;
```

### 3. 配置文件检查

检查 [application.yaml](../../../src/main/resources/application.yaml) 中的数据库配置：

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/campus_club?useUnicode=true&characterEncoding=utf-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai
    username: root
    password: root  # 修改为你的密码
```

## 启动步骤

### 方式一：IDE 启动

1. 导入项目到 IDE
2. Maven 依赖下载完成后
3. 运行 `CampusClubManagerBackendApplication.main()`

### 方式二：命令行启动

```bash
# 编译打包
mvn clean package -DskipTests

# 启动应用
java -jar target/campus-club-manager-backend-0.0.1-SNAPSHOT.jar
```

## 验证启动

### 1. 查看启动日志

确认以下关键信息：

```
✓ Tomcat started on port 8080
✓ Started CampusClubManagerBackendApplication
✓ MyBatis-Plus 配置加载成功
✓ Sa-Token 配置加载成功
```

### 2. 访问 Swagger 文档

打开浏览器访问：`http://localhost:8080/api/doc.html`

应该能看到 API 文档界面。

## 功能测试

### 测试一：用户注册

```bash
curl -X POST http://localhost:8080/api/user/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "newuser",
    "password": "123456",
    "realName": "新用户",
    "studentId": "20240001",
    "email": "newuser@campus.com",
    "phone": "13800138000"
  }'

# 预期响应
{
  "code": 200,
  "message": "注册成功",
  "data": null
}
```

### 测试二：用户登录

```bash
curl -X POST http://localhost:8080/api/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test_user",
    "password": "123456"
  }'

# 预期响应
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJ0eXAiOiJKV1Qi...",
    "userInfo": {
      "id": 2,
      "username": "test_user",
      "realName": "测试用户",
      "role": "user",
      ...
    }
  }
}
```

### 测试三：获取用户信息（需要 Token）

```bash
# 将上一步获取的 token 替换到下面的命令中
curl -X GET http://localhost:8080/api/user/info \
  -H "Authorization: Bearer {替换为实际的token}"

# 预期响应
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 2,
    "username": "test_user",
    ...
  }
}
```

### 测试四：更新用户信息

```bash
curl -X POST http://localhost:8080/api/user/update \
  -H "Authorization: Bearer {替换为实际的token}" \
  -H "Content-Type: application/json" \
  -d '{
    "realName": "测试用户-已更新",
    "phone": "13900139000"
  }'

# 预期响应
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

## 常见问题

### 1. 端口被占用

```bash
# Windows 查找占用端口的进程
netstat -ano | findstr :8080

# Linux/Mac 查找占用端口的进程
lsof -i :8080

# 修改端口（application.yaml）
server:
  port: 8081  # 改为其他端口
```

### 2. 数据库连接失败

检查事项：
- MySQL 服务是否启动
- 数据库名称是否正确
- 用户名密码是否正确
- 防火墙是否允许连接

### 3. Maven 依赖下载慢

配置国内镜像（settings.xml）：

```xml
<mirror>
  <id>aliyun</id>
  <mirrorOf>central</mirrorOf>
  <url>https://maven.aliyun.com/repository/public</url>
</mirror>
```

### 4. Token 验证失败

- 检查 Token 是否过期（默认30天）
- 检查 Token 格式：`Authorization: Bearer {token}`
- 检查 Token 前后是否有空格

## 下一步

1. 阅读 [RBAC权限系统使用指南](RBAC权限系统使用指南.md) 了解权限体系
2. 阅读 [学校社团管理平台 · 后端开发项目文档](../../../docs/学校社团管理平台%20·%20后端开发项目文档.md) 了解整体架构
3. 开始开发其他模块（社团管理、活动管理等）

## 开发建议

1. **使用 Swagger 测试 API**
   - 访问：`http://localhost:8080/api/doc.html`
   - 先调用登录接口获取 Token
   - 点击 "Authorize" 按钮输入 Token
   - 测试其他需要权限的接口

2. **查看日志**
   - MyBatis SQL 日志已开启
   - 可以在控制台看到执行的 SQL 语句
   - 异常会打印详细堆栈

3. **开发新功能**
   - 参考 UserController 的写法
   - 使用 `@SaCheckRole` 添加权限控制
   - 使用 `@Valid` 验证请求参数
   - 统一使用 `Result<T>` 返回响应

4. **数据库变更**
   - 在 `db/migration` 目录下创建新的 SQL 文件
   - 文件命名规范：`V{版本号}__{描述}.sql`
   - 如：`V2__Create_Club_Table.sql`
